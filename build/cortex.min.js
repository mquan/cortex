!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.cortex=e()}}(function(){var e;return function t(e,n,i){function r(s,u){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!u&&l)return l(s,!0);if(a)return a(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var o=n[s]={exports:{}};e[s][0].call(o.exports,function(t){var n=e[s][1][t];return r(n?n:t)},o,o.exports,t,e,n,i)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t){"use strict";var n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function s(e,t,n){var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:s(r,t,n)}if("value"in i)return i.value;var a=i.get;return void 0===a?void 0:a.call(n)},a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)};t.exports=function(){var t=e("./pubsub"),s=e("./data_wrapper")(t),u={N:"new",E:"update",A:"update",D:"delete"},l=function(e){function s(e,t){n(this,s),r(Object.getPrototypeOf(s.prototype),"constructor",this).call(this),this.__value=e,this.__path=[],this.__updates=[],this.__callbacks=t?[t]:[],this.__loopProcessing=!1,this.__subscribe(),this.__changes=[],this.__wrap()}return a(s,e),i(s,[{key:"on",value:function(e,t){"update"===e&&this.__callbacks.push(t)}},{key:"off",value:function(e,t){if("update"===e)if(t){for(var n=0,i=this.__callbacks.length;i>n;n++)if(t===this.__callbacks[n]){this.__callbacks.splice(n,1);break}}else this.__callbacks=[]}},{key:"update",value:function(e){return this.__checkUpdate(e.oldValue,e.value,e.path)?(this.__loopProcessing||(this.__loopProcessing=!0,setTimeout(this.__batchAll.bind(this),0)),!0):!1}},{key:"__batchAll",value:function(){this.__batchSetValue(),this.__wrap(),this.__loopProcessing=!1,this.__runCallbacks()}},{key:"__batchSetValue",value:function(){for(var e=0,t=this.__updates.length;t>e;e++)this.__setValue(this.__updates[e].newValue,this.__updates[e].path);this.__updates=[]}},{key:"__runCallbacks",value:function(){for(var e=0,t=this.__callbacks.length;t>e;e++)this.__callbacks[e]&&this.__callbacks[e](this)}},{key:"__subscribe",value:function(){this.__eventId=t.subscribeToCortex(function(e,t){this.update(t)}.bind(this),function(e,t){this.__remove(t.path)}.bind(this))}},{key:"__remove",value:function(e){if(e.length){var t=e.slice(0,e.length-1),n=this.__subValue(t),i=e[e.length-1],r=n[i],a=this.__clone(n);return n.constructor===Object?delete n[i]:n.constructor===Array&&n.splice(i,1),this.update({value:n,path:t,oldValue:a}),r}delete this.__wrappers,delete this.__value}},{key:"__setValue",value:function(e,t){if(t.length>1){var n=this.__subValue(t.slice(0,t.length-1));n[t[t.length-1]]=e}else 1===t.length?this.__value[t[0]]=e:this.__value=e}},{key:"__checkUpdate",value:function(e,t,n){var i;if(e)return i=this.__diff(e,t),this.__computeChanges(i,n),!0;var e=this.__subValue(n);return i=this.__diff(e,t),i?(this.__updates.push({newValue:t,path:n}),this.__computeChanges(i,n),!0):!1}},{key:"__computeChanges",value:function(e,t){var n,i,r;this.__loopProcessing||(this.__changes=[]);for(var a=0,s=e.length;s>a;a++)r=e[a],n=u[r.item?r.item.kind:r.kind],i=t.slice(),r.path&&(i=i.concat(r.path)),r.index&&i.push(r.index),this.__changes.push({type:n,path:i,oldValue:r.item?r.item.lhs:r.lhs,newValue:r.item?r.item.rhs:r.rhs})}}]),s}(s);return"undefined"!=typeof window&&null!==window&&(window.Cortex=l),l}()},{"./data_wrapper":3,"./pubsub":4}],2:[function(t,n,i){(function(t){!function(t,r){"use strict";"function"==typeof e&&e.amd?e([],r):"object"==typeof i?n.exports=r():t.DeepDiff=r()}(this,function(e){"use strict";function n(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function i(e,t){Object.defineProperty(this,"kind",{value:e,enumerable:!0}),t&&t.length&&Object.defineProperty(this,"path",{value:t,enumerable:!0})}function r(e,t,n){r.super_.call(this,"E",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0}),Object.defineProperty(this,"rhs",{value:n,enumerable:!0})}function a(e,t){a.super_.call(this,"N",e),Object.defineProperty(this,"rhs",{value:t,enumerable:!0})}function s(e,t){s.super_.call(this,"D",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0})}function u(e,t,n){u.super_.call(this,"A",e),Object.defineProperty(this,"index",{value:t,enumerable:!0}),Object.defineProperty(this,"item",{value:n,enumerable:!0})}function l(e,t,n){var i=e.slice((n||t)+1||e.length);return e.length=0>t?e.length+t:t,e.push.apply(e,i),e}function h(e){var t=typeof e;return"object"!==t?t:e===Math?"math":null===e?"null":Array.isArray(e)?"array":e instanceof Date?"date":/^\/.*\//.test(e.toString())?"regexp":"object"}function o(t,n,i,c,_,f,p){_=_||[];var v=_.slice(0);if("undefined"!=typeof f){if(c&&c(v,f))return;v.push(f)}var d=typeof t,b=typeof n;if("undefined"===d)"undefined"!==b&&i(new a(v,n));else if("undefined"===b)i(new s(v,t));else if(h(t)!==h(n))i(new r(v,t,n));else if(t instanceof Date&&n instanceof Date&&t-n!==0)i(new r(v,t,n));else if("object"===d&&null!==t&&null!==n){if(p=p||[],p.indexOf(t)<0){if(p.push(t),Array.isArray(t)){{var y;t.length}for(y=0;y<t.length;y++)y>=n.length?i(new u(v,y,new s(e,t[y]))):o(t[y],n[y],i,c,v,y,p);for(;y<n.length;)i(new u(v,y,new a(e,n[y++])))}else{var w=Object.keys(t),g=Object.keys(n);w.forEach(function(r){var a=g.indexOf(r);a>=0?(o(t[r],n[r],i,c,v,r,p),g=l(g,a)):o(t[r],e,i,c,v,r,p)}),g.forEach(function(t){o(e,n[t],i,c,v,t,p)})}p.length=p.length-1}}else t!==n&&("number"===d&&isNaN(t)&&isNaN(n)||i(new r(v,t,n)))}function c(t,n,i,r){return r=r||[],o(t,n,function(e){e&&r.push(e)},i),r.length?r:e}function _(e,t,n){if(n.path&&n.path.length){var i,r=e[t],a=n.path.length-1;for(i=0;a>i;i++)r=r[n.path[i]];switch(n.kind){case"A":_(r[n.path[i]],n.index,n.item);break;case"D":delete r[n.path[i]];break;case"E":case"N":r[n.path[i]]=n.rhs}}else switch(n.kind){case"A":_(e[t],n.index,n.item);break;case"D":e=l(e,t);break;case"E":case"N":e[t]=n.rhs}return e}function f(e,t,n){if(e&&t&&n&&n.kind){for(var i=e,r=-1,a=n.path.length-1;++r<a;)"undefined"==typeof i[n.path[r]]&&(i[n.path[r]]="number"==typeof n.path[r]?[]:{}),i=i[n.path[r]];switch(n.kind){case"A":_(i[n.path[r]],n.index,n.item);break;case"D":delete i[n.path[r]];break;case"E":case"N":i[n.path[r]]=n.rhs}}}function p(e,t,n){if(n.path&&n.path.length){var i,r=e[t],a=n.path.length-1;for(i=0;a>i;i++)r=r[n.path[i]];switch(n.kind){case"A":p(r[n.path[i]],n.index,n.item);break;case"D":r[n.path[i]]=n.lhs;break;case"E":r[n.path[i]]=n.lhs;break;case"N":delete r[n.path[i]]}}else switch(n.kind){case"A":p(e[t],n.index,n.item);break;case"D":e[t]=n.lhs;break;case"E":e[t]=n.lhs;break;case"N":e=l(e,t)}return e}function v(e,t,n){if(e&&t&&n&&n.kind){var i,r,a=e;for(r=n.path.length-1,i=0;r>i;i++)"undefined"==typeof a[n.path[i]]&&(a[n.path[i]]={}),a=a[n.path[i]];switch(n.kind){case"A":p(a[n.path[i]],n.index,n.item);break;case"D":a[n.path[i]]=n.lhs;break;case"E":a[n.path[i]]=n.lhs;break;case"N":delete a[n.path[i]]}}}function d(e,t,n){if(e&&t){var i=function(i){(!n||n(e,t,i))&&f(e,t,i)};o(e,t,i)}}var b,y,w=[];return b="object"==typeof t&&t?t:"undefined"!=typeof window?window:{},y=b.DeepDiff,y&&w.push(function(){"undefined"!=typeof y&&b.DeepDiff===c&&(b.DeepDiff=y,y=e)}),n(r,i),n(a,i),n(s,i),n(u,i),Object.defineProperties(c,{diff:{value:c,enumerable:!0},observableDiff:{value:o,enumerable:!0},applyDiff:{value:d,enumerable:!0},applyChange:{value:f,enumerable:!0},revertChange:{value:v,enumerable:!0},isConflict:{value:function(){return"undefined"!=typeof y},enumerable:!0},noConflict:{value:function(){return w&&(w.forEach(function(e){e()}),w=null),c},enumerable:!0}}),c})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t){"use strict";var n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.exports=function(t){var r=e("deep-diff").diff,a=function(){function e(t){n(this,e),this.__eventId=t.eventId,this.__value=t.value,this.__path=t.path||[],this.__changes=t.changes||[],this.__wrap(),this.val=this.getValue}return i(e,[{key:"set",value:function(e,n){var i=n||{};i.value=e,i.path=this.__path,t.publish("update"+this.__eventId,i)}},{key:"getValue",value:function(){return this.__value}},{key:"getPath",value:function(){return this.__path}},{key:"getKey",value:function(){return this.__path[this.__path.length-1]}},{key:"getChanges",value:function(){return this.__changes}},{key:"didChange",value:function(e){if(!e)return this.__changes.length>0;for(var t=0,n=this.__changes.length;n>t;t++){var i=this.__changes[t];if(i.path[0]===e||this.__hasChange(i,e))return!0}return!1}},{key:"forEach",value:function(e){if(this.__isObject())for(var t in this.__wrappers)e(t,this.__wrappers[t],this.__wrappers);else this.__isArray()&&this.__wrappers.forEach(e)}},{key:"remove",value:function(){t.publish("remove"+this.__eventId,{path:this.__path})}},{key:"__subValue",value:function(e){for(var t=this.__value,n=0,i=e.length;i>n;n++)t=t[e[n]];return t}},{key:"__wrap",value:function(){if(this.__cleanup(),this.__isObject()){this.__wrappers={};for(var e in this.__value)this.__wrapChild(e)}else if(this.__isArray()){this.__wrappers=[];for(var t=0,n=this.__value.length;n>t;t++)this.__wrapChild(t)}}},{key:"__wrapChild",value:function(t){var n=this.__path.slice();n.push(t),this.__wrappers[t]=new e({value:this.__value[t],path:n,eventId:this.__eventId,changes:this.__childChanges(t)}),this[t]=this.__wrappers[t]}},{key:"__childChanges",value:function(e){for(var t,n=[],i=0,r=this.__changes.length;r>i;i++){if(t=this.__changes[i],t.path[0]===e){n.push({type:t.type,path:t.path.slice(1,t.path.length),oldValue:t.oldValue,newValue:t.newValue});break}if(this.__hasChange(t,e)){n.push({type:t.type,path:[],oldValue:t.oldValue?t.oldValue[e]:void 0,newValue:t.newValue?t.newValue[e]:void 0});break}}return n}},{key:"__hasChange",value:function(e,t){return 0===e.path.length&&(e.oldValue&&e.oldValue[t]||e.newValue&&e.newValue[t])}},{key:"__cleanup",value:function(){if(this.__wrappers){if(this.__isObject())for(var e in this.__wrappers)delete this[e];else if(this.__isArray())for(var t=0,n=this.__wrappers.length;n>t;t++)delete this[t];delete this.__wrappers}}},{key:"__isObject",value:function(){return this.__value&&this.__value.constructor===Object}},{key:"__isArray",value:function(){return this.__value&&this.__value.constructor===Array}},{key:"__diff",value:function(e,t){return r(e,t)}},{key:"__clone",value:function(e){var t;if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return t=new Date,t.setTime(e.getTime()),t;if(e instanceof Array){t=[];for(var n=0,i=e.length;i>n;n++)t[n]=this.__clone(e[n]);return t}if(e instanceof Object){t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=this.__clone(e[r]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")}}]),e}(),s=e("./wrappers/array"),u=e("./wrappers/hash"),l=function(e,t){for(var n=0,i=t.length;i>n;n++)for(var r in t[n])e.prototype[r]=t[n][r]};return l(a,[s,u]),a}},{"./wrappers/array":5,"./wrappers/hash":6,"deep-diff":2}],4:[function(e,t){"use strict";var n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.exports=function(){var e=function(){function e(){n(this,e),this.uid=-1,this.topics={}}return i(e,[{key:"subscribe",value:function(e,t){this.topics.hasOwnProperty(e)||(this.topics[e]=[]),this.topics[e].push({callback:t})}},{key:"publish",value:function(e,t){if(!this.topics.hasOwnProperty(e))return!1;for(var n=this.topics[e],i=0,r=n.length;r>i;i++)n[i].callback(e,t);return!0}},{key:"subscribeToCortex",value:function(e,t){return this.uid+=1,this.subscribe("update"+this.uid,e),this.subscribe("remove"+this.uid,t),this.uid}},{key:"unsubscribeFromCortex",value:function(e){delete this.topics["update"+e],delete this.topics["remove"+e]}}]),e}();return new e}()},{}],5:[function(e,t){"use strict";var n={count:function(){return this.__value.length},map:function(e){return this.__wrappers.map(e)},filter:function(e,t){return this.__wrappers.filter(e,t)},find:function(e){for(var t=0,n=this.__wrappers.length;n>t;t++)if(e(this.__wrappers[t],t,this.__wrappers))return this.__wrappers[t];return null},findIndex:function(e){for(var t=0,n=this.__wrappers.length;n>t;t++)if(e(this.__wrappers[t],t,this.__wrappers))return t;return-1},push:function(e){var t=this.__clone(this.__value),n=this.__value.push(e);return this.set(this.__value,{oldValue:t}),n},pop:function(){var e=this.__clone(this.__value),t=this.__value.pop();return this.set(this.__value,{oldValue:e}),t},unshift:function(e){var t=this.__clone(this.__value),n=this.__value.unshift(e);return this.set(this.__value,{oldValue:t}),n},shift:function(){var e=this.__clone(this.__value),t=this.__value.shift();return this.set(this.__value,{oldValue:e}),t},insertAt:function(e){var t=this.__clone(this.__value),n=Array.prototype.slice.call(arguments,1);Array.prototype.splice.apply(this.__value,[e,0].concat(n)),this.set(this.__value,{oldValue:t})},removeAt:function(e){var t=void 0===arguments[1]?1:arguments[1],n=this.__clone(this.__value),i=this.__value.splice(e,t);return this.set(this.__value,{oldValue:n}),i}};t.exports=n},{}],6:[function(e,t){"use strict";var n={keys:function(){return Object.keys(this.__value)},values:function i(){var e,i=[];for(e in this.__value)i.push(this.__value[e]);return i},hasKey:function(e){return null!=this.__value[e]},destroy:function(e){var t=this.__clone(this.__value),n=this.__value[e];return delete this.__value[e],this.set(this.__value,{oldValue:t}),n},add:function(e,t){var n=this.__clone(this.__value);return this.__value[e]=t,this.set(this.__value,{oldValue:n}),t}};t.exports=n},{}]},{},[1])(1)});